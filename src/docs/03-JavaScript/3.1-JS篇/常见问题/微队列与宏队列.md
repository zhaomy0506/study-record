æ‚¨å¥½ï¼Œè¿™æ˜¯ Copilotã€‚æˆ‘å¯ä»¥å¸®åŠ©æ‚¨å°†é¡µé¢å†…å®¹ç¿»è¯‘æˆä¸­æ–‡æ–‡ç« ã€‚ðŸ˜Š

ä»¥ä¸‹æ˜¯æˆ‘æ ¹æ®é¡µé¢å†…å®¹ç”Ÿæˆçš„ä¸­æ–‡æ–‡ç« ï¼š

## å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

æˆ‘åˆšåˆšè¯»å®Œäº† Promises/A+ è§„èŒƒï¼Œå‘çŽ°äº†å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡è¿™ä¸¤ä¸ªæœ¯è¯­ï¼šhttp://promisesaplus.com/#notes

æˆ‘ä»¥å‰ä»Žæ¥æ²¡æœ‰å¬è¯´è¿‡è¿™ä¸¤ä¸ªæœ¯è¯­ï¼ŒçŽ°åœ¨æˆ‘å¾ˆå¥½å¥‡å®ƒä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

[æˆ‘å·²ç»å°è¯•åœ¨ç½‘ä¸Šæ‰¾ä¸€äº›ä¿¡æ¯ï¼Œä½†æ˜¯æˆ‘åªæ‰¾åˆ°äº†è¿™ç¯‡æ¥è‡ª w3.org å½’æ¡£çš„å¸–å­ï¼ˆå®ƒæ²¡æœ‰ç»™æˆ‘è§£é‡Šæ¸…æ¥šåŒºåˆ«ï¼‰ï¼šhttp://lists.w3.org/Archives/Public/public-nextweb/2013Jul/0018.html](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|1|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"I've alrea..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A3%2C"highlightText"%3A"I've already tried to find some information on the web%2C but all I've found is this post from the w3.org Archives (which does not explain the difference to me)%3A http%3A%2F%2Flists.w3.org%2FArchives%2FPublic%2Fpublic-nextweb%2F2013Jul%2F0018.html"%2C"snippets"%3A[]}})[2](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|1|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"I've alrea..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A3%2C"highlightText"%3A"I've already tried to find some information on the web%2C but all I've found is this post from the w3.org Archives (which does not explain the difference to me)%3A http%3A%2F%2Flists.w3.org%2FArchives%2FPublic%2Fpublic-nextweb%2F2013Jul%2F0018.html"%2C"snippets"%3A[]}})

å¦å¤–ï¼Œæˆ‘è¿˜å‘çŽ°äº†ä¸€ä¸ªå«åš â€œmacrotaskâ€ çš„ npm æ¨¡å—ï¼šhttps://www.npmjs.org/package/macrotask åŒæ ·ï¼Œå®ƒä¹Ÿæ²¡æœ‰æ¾„æ¸…åŒºåˆ«åˆ°åº•æ˜¯ä»€ä¹ˆã€‚

[æˆ‘æ‰€çŸ¥é“çš„æ˜¯ï¼Œå®ƒä»¬å’Œäº‹ä»¶å¾ªçŽ¯æœ‰å…³ï¼Œå¦‚ https://html.spec.whatwg.org/multipage/webappapis.html#task-queue å’Œ https://html.spec.whatwg.org/multipage/webappapis.html#perform-a-microtask-checkpoint æ‰€æè¿°çš„ã€‚](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|2|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"All I know..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A5%2C"highlightText"%3A"All I know is%2C that it has something to do with the event loop%2C as described in https%3A%2F%2Fhtml.spec.whatwg.org%2Fmultipage%2Fwebappapis.html%23task-queue and https%3A%2F%2Fhtml.spec.whatwg.org%2Fmultipage%2Fwebappapis.html%23perform-a-microtask-checkpoint"%2C"snippets"%3A[]}})[3](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|2|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"All I know..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A5%2C"highlightText"%3A"All I know is%2C that it has something to do with the event loop%2C as described in https%3A%2F%2Fhtml.spec.whatwg.org%2Fmultipage%2Fwebappapis.html%23task-queue and https%3A%2F%2Fhtml.spec.whatwg.org%2Fmultipage%2Fwebappapis.html%23perform-a-microtask-checkpoint"%2C"snippets"%3A[]}})

æˆ‘çŸ¥é“æˆ‘ç†è®ºä¸Šåº”è¯¥èƒ½å¤Ÿä»Žè¿™ä¸ª WHATWG è§„èŒƒä¸­è‡ªå·±æå–å‡ºåŒºåˆ«ï¼Œä½†æ˜¯æˆ‘ç›¸ä¿¡å…¶ä»–äººä¹Ÿå¯ä»¥ä»Žä¸€ä¸ªä¸“å®¶çš„ç®€çŸ­è§£é‡Šä¸­å—ç›Šã€‚

[ç®€è€Œè¨€ä¹‹ï¼šå¤šä¸ªåµŒå¥—çš„äº‹ä»¶é˜Ÿåˆ—ã€‚ä½ ç”šè‡³å¯ä»¥è‡ªå·±å®žçŽ°ä¸€ä¸ªï¼šwhile (task = todo.shift ()) task ();](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|3|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"You could ..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A7%2C"highlightText"%3A"You could even implement one yourself%3A while (task %3D todo.shift ()) task ()%3B"%2C"snippets"%3A[]}})[4](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|3|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"You could ..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A7%2C"highlightText"%3A"You could even implement one yourself%3A while (task %3D todo.shift ()) task ()%3B"%2C"snippets"%3A[]}})

äº‹ä»¶å¾ªçŽ¯çš„ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæœ€å¤šä¼šæ‰§è¡Œä¸€ä¸ªæ¥è‡ªå®ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼ˆè¿™ä¸ªé˜Ÿåˆ—åœ¨ WHATWG è§„èŒƒä¸­ç®€ç§°ä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€‚åœ¨è¿™ä¸ªå®ä»»åŠ¡å®ŒæˆåŽï¼Œæ‰€æœ‰å¯ç”¨çš„å¾®ä»»åŠ¡éƒ½ä¼šè¢«æ‰§è¡Œï¼Œå³åœ¨åŒä¸€æ¬¡è¿­ä»£å‘¨æœŸä¸­ã€‚åœ¨è¿™äº›å¾®ä»»åŠ¡è¢«æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå®ƒä»¬å¯ä»¥å†æ¬¡å…¥é˜Ÿæ›´å¤šçš„å¾®ä»»åŠ¡ï¼Œè¿™äº›å¾®ä»»åŠ¡ä¼šä¸€ä¸ªæŽ¥ä¸€ä¸ªåœ°è¿è¡Œï¼Œç›´åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—è¢«æ¸…ç©ºã€‚

å¦‚æžœä¸€ä¸ªå¾®ä»»åŠ¡é€’å½’åœ°å…¥é˜Ÿå…¶ä»–å¾®ä»»åŠ¡ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šèŠ±è´¹å¾ˆé•¿æ—¶é—´æ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚è¿™æ„å‘³ç€ï¼Œä½ å¯èƒ½ä¼šé‡åˆ° UI é˜»å¡žï¼Œæˆ–è€…ä¸€äº›å·²ç»å®Œæˆçš„ I/O åœ¨ä½ çš„åº”ç”¨ä¸­é—²ç½®ã€‚

[ç„¶è€Œï¼Œè‡³å°‘å…³äºŽ Node.js çš„ process.nextTick å‡½æ•°ï¼ˆå®ƒå…¥é˜Ÿå¾®ä»»åŠ¡ï¼‰ï¼Œæœ‰ä¸€ä¸ªå†…ç½®çš„é˜²æ­¢é˜»å¡žçš„æœºåˆ¶ï¼Œå³ process.maxTickDepthã€‚](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|4|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"However%2C a..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A10%2C"highlightText"%3A"However%2C at least concerning Node.js's process.nextTick function (which queues microtasks )%2C there is an inbuilt protection against such blocking by means of process.maxTickDepth."%2C"snippets"%3A[]}})[5](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|4|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"However%2C a..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A10%2C"highlightText"%3A"However%2C at least concerning Node.js's process.nextTick function (which queues microtasks )%2C there is an inbuilt protection against such blocking by means of process.maxTickDepth."%2C"snippets"%3A[]}})è¿™ä¸ªå€¼é»˜è®¤è®¾ç½®ä¸º 1000ï¼Œå½“è¾¾åˆ°è¿™ä¸ªé™åˆ¶åŽï¼Œå°±ä¼šåœæ­¢è¿›ä¸€æ­¥å¤„ç†å¾®ä»»åŠ¡ï¼Œä»Žè€Œå…è®¸ä¸‹ä¸€ä¸ªå®ä»»åŠ¡è¢«æ‰§è¡Œï¼‰

åŸºæœ¬ä¸Šï¼Œå½“ä½ éœ€è¦ä»¥åŒæ­¥çš„æ–¹å¼æ‰§è¡Œä¸€äº›å¼‚æ­¥çš„æ“ä½œï¼ˆå³å½“ä½ æƒ³è¯´åœ¨æœ€è¿‘çš„æœªæ¥æ‰§è¡Œè¿™ä¸ªï¼ˆå¾®ï¼‰ä»»åŠ¡ï¼‰æ—¶ï¼Œä½¿ç”¨å¾®ä»»åŠ¡ã€‚å¦åˆ™ï¼ŒåšæŒä½¿ç”¨å®ä»»åŠ¡ã€‚

[å®ä»»åŠ¡ï¼šsetTimeout, setInterval, setImmediate, requestAnimationFrame, I/O, UI æ¸²æŸ“](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|5|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"setTimeout..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A56%2C"highlightText"%3A"setTimeout%2C setInterval%2C setImmediate%2C requestAnimationFrame%2C I%2FO%2C UI rendering are part of the macrotask queue."%2C"snippets"%3A[]}})[6](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|5|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"setTimeout..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A56%2C"highlightText"%3A"setTimeout%2C setInterval%2C setImmediate%2C requestAnimationFrame%2C I%2FO%2C UI rendering are part of the macrotask queue."%2C"snippets"%3A[]}})[7](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|6|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"macrotasks..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A12%2C"highlightText"%3A"macrotasks%3A setTimeout%2C setInterval%2C setImmediate%2C requestAnimationFrame%2C I%2FO%2C UI rendering microtasks%3A process.nextTick%2C Promises%2C queueMicrotask%2C MutationObserver"%2C"snippets"%3A[]}})[ å¾®ä»»åŠ¡ï¼šprocess.nextTick, Promises, queueMicrotask, MutationObserver](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|7|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"process.ne..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A57%2C"highlightText"%3A"process.nextTick%2C Promises%2C Object.observe%2C MutationObserver are part of the microtasks queue."%2C"snippets"%3A[]}})[8](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|7|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"process.ne..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A57%2C"highlightText"%3A"process.nextTick%2C Promises%2C Object.observe%2C MutationObserver are part of the microtasks queue."%2C"snippets"%3A[]}})

è™½ç„¶äº‹ä»¶å¾ªçŽ¯ä¸­æœ‰ä¸€ä¸ªå¾®ä»»åŠ¡æ£€æŸ¥ç‚¹ï¼Œä½†è¿™å¹¶ä¸æ˜¯å¤§å¤šæ•°å¼€å‘è€…ä¼šé‡åˆ°å¾®ä»»åŠ¡çš„åœ°æ–¹ã€‚å¾®ä»»åŠ¡æ˜¯åœ¨ JS æ ˆæ¸…ç©ºæ—¶æ‰§è¡Œçš„ã€‚è¿™å¯èƒ½åœ¨ä¸€ä¸ªä»»åŠ¡ä¸­å‘ç”Ÿå¤šæ¬¡ï¼Œç”šè‡³åœ¨äº‹ä»¶å¾ªçŽ¯çš„æ¸²æŸ“æ­¥éª¤ä¸­å‘ç”Ÿã€‚

[process.maxTickDepth å·²ç»åœ¨å¾ˆä¹…ä»¥å‰å°±è¢«ç§»é™¤äº†ï¼šgithub.com/nodejs/node/blob/â€¦](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|8|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"process.ma..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A14%2C"highlightText"%3A"process.maxTickDepth was removed very long time ago%3A github.com%2Fnodejs%2Fnode%2Fblob%2Fâ€¦"%2C"snippets"%3A[]}})[9](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|8|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"process.ma..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A14%2C"highlightText"%3A"process.maxTickDepth was removed very long time ago%3A github.com%2Fnodejs%2Fnode%2Fblob%2Fâ€¦"%2C"snippets"%3A[]}})

requestAnimationFrame (rAF) ä¸ä»…ç”Ÿæˆå¾®ä»»åŠ¡ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒrAF è°ƒç”¨ä¼šåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—

â€œå½“ä½ éœ€è¦ä»¥åŒæ­¥çš„æ–¹å¼æ‰§è¡Œä¸€äº›å¼‚æ­¥çš„æ“ä½œï¼Ÿâ€

ä¸€ä¸ªäº‹ä»¶å¾ªçŽ¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—ã€‚ï¼ˆä»»åŠ¡é˜Ÿåˆ—å°±æ˜¯å®ä»»åŠ¡é˜Ÿåˆ—ï¼‰

ä¸€ä¸ªä»»åŠ¡å¯ä»¥è¢«æŽ¨å…¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæˆ–è€…å¾®ä»»åŠ¡é˜Ÿåˆ—

å½“ä¸€ä¸ªä»»åŠ¡è¢«æŽ¨å…¥ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆå¾®/å®ï¼‰æ—¶ï¼Œæˆ‘ä»¬æ„å‘³ç€å‡†å¤‡å·¥ä½œå·²ç»å®Œæˆï¼Œæ‰€ä»¥è¿™ä¸ªä»»åŠ¡çŽ°åœ¨å¯ä»¥è¢«æ‰§è¡Œäº†ã€‚

(b).å¦‚æžœä»»åŠ¡ x æ˜¯ç©ºçš„ï¼ˆæ„å‘³ç€å¾®ä»»åŠ¡é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼‰ï¼Œè·³åˆ°æ­¥éª¤ (g)

(f).é€‰æ‹©å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ€æ—§çš„ä»»åŠ¡ï¼Œè·³åˆ°æ­¥éª¤ (b)

æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å¯ç”¨ä»»åŠ¡ï¼Œç„¶åŽç§»é™¤å®ƒä»¬ã€‚

promiseA è¢«è§£å†³/æ‹’ç»ï¼šè¿™ä¸ªä»»åŠ¡ä¼šè¢«æŽ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œåœ¨å½“å‰äº‹ä»¶å¾ªçŽ¯çš„è½®æ¬¡ä¸­ã€‚

promiseA æ˜¯å¾…å®šçš„ï¼šè¿™ä¸ªä»»åŠ¡ä¼šè¢«æŽ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œåœ¨æœªæ¥çš„äº‹ä»¶å¾ªçŽ¯çš„è½®æ¬¡ä¸­ï¼ˆå¯èƒ½æ˜¯ä¸‹ä¸€è½®ï¼‰

[setTimeout (callback,n) çš„å›žè°ƒæ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”ä¼šè¢«æŽ¨å…¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå³ä½¿ n æ˜¯ 0ï¼›](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|9|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"setTimeout..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A25%2C"highlightText"%3A"setTimeout (callback%2Cn)'s callback is a task%2Cand will be pushed into macrotask queue%2Ceven n is 0%3B"%2C"snippets"%3A[]}})[10](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|9|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"setTimeout..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A25%2C"highlightText"%3A"setTimeout (callback%2Cn)'s callback is a task%2Cand will be pushed into macrotask queue%2Ceven n is 0%3B"%2C"snippets"%3A[]}})

å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¼šåœ¨å½“å‰è½®æ¬¡ä¸­è¿è¡Œï¼Œè€Œå®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å¿…é¡»ç­‰å¾…ä¸‹ä¸€è½®äº‹ä»¶å¾ªçŽ¯ã€‚

[æˆ‘ä»¬éƒ½çŸ¥é“ â€œclickâ€,â€œscrollâ€,â€œajaxâ€,"setTimeout"](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|10|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"we all kno..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A27%2C"highlightText"%3A"we all know callback of \"click\"%2C\"scroll\"%2C\"ajax\"%2C\"setTimeout\"... are tasks%2Chowever we should also remember js codes as a whole in script tag is a task (a macrotask) too."%2C"snippets"%3A[]}})[11](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|10|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"we all kno..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A27%2C"highlightText"%3A"we all know callback of \"click\"%2C\"scroll\"%2C\"ajax\"%2C\"setTimeout\"... are tasks%2Chowever we should also remember js codes as a whole in script tag is a task (a macrotask) too."%2C"snippets"%3A[]}})â€¦ çš„å›žè°ƒæ˜¯ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿåº”è¯¥è®°ä½ script æ ‡ç­¾ä¸­çš„æ•´ä¸ª js ä»£ç ä¹Ÿæ˜¯ä¸€ä¸ªä»»åŠ¡ï¼ˆä¸€ä¸ªå®ä»»åŠ¡ï¼‰ã€‚

è¿™æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„è§£é‡Šï¼è°¢è°¢åˆ†äº«ï¼è¿˜æœ‰ä¸€ç‚¹è¦æçš„æ˜¯ï¼Œåœ¨ NodeJs ä¸­ï¼ŒsetImmediate () æ˜¯å®ä»»åŠ¡ï¼Œè€Œ process.nextTick () æ˜¯å¾®ä»»åŠ¡ã€‚

æµè§ˆå™¨çš„ç»˜åˆ¶ä»»åŠ¡å±žäºŽå“ªä¸€ç±»å‘¢ï¼Ÿå®ƒä»¬ä¼šé€‚åˆå“ªä¸ªç±»åˆ«ï¼Ÿ

æˆ‘ä¸çŸ¥é“æˆ‘æ˜¯å¦æžé”™äº†ï¼Œä½†æˆ‘æœ‰ç‚¹ä¸åŒæ„è¿™ä¸ªç­”æ¡ˆï¼Œå¾®ä»»åŠ¡æ˜¯åœ¨å®ä»»åŠ¡ä¹‹å‰è¿è¡Œçš„ã€‚codepen.io/walox/pen/yLYjNRq?

@walox å½“å‰è„šæœ¬çš„æ‰§è¡Œä¹Ÿæ˜¯ä¸€ä¸ªå®ä»»åŠ¡ã€‚å½“æ‰€æœ‰çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•åŽï¼Œäº‹ä»¶å¾ªçŽ¯ä¼šä¼˜å…ˆå¤„ç†å¾®ä»»åŠ¡è€Œä¸æ˜¯å®ä»»åŠ¡ã€‚å°±åƒä½ çš„ä¾‹å­ä¸­ï¼Œè„šæœ¬æ‰§è¡Œå®ŒåŽï¼Œtimeout å›žè°ƒåœ¨å®ä»»åŠ¡/å›žè°ƒé˜Ÿåˆ—ä¸­ï¼Œè€Œ promise å›žè°ƒåœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚ç”±äºŽä¸€ä¸ªå®ä»»åŠ¡å·²ç»å®Œæˆï¼ˆä¸»è„šæœ¬æ‰§è¡Œï¼‰ï¼Œäº‹ä»¶å¾ªçŽ¯ä¼šä¼˜å…ˆå¤„ç† promise ä»»åŠ¡è€Œä¸æ˜¯ timeout ä»»åŠ¡ã€‚å› æ­¤å¾—åˆ°è¿™ä¸ªç»“æžœã€‚

æˆ‘è®¤ä¸ºæˆ‘ä»¬ä¸èƒ½å°†äº‹ä»¶å¾ªçŽ¯ä¸Žæ ˆåˆ†å¼€è®¨è®ºï¼Œæ‰€ä»¥ï¼š

- æ ‡å‡†æ ˆç”¨äºŽæ‰€æœ‰åŒæ­¥è°ƒç”¨ï¼ˆä¸€ä¸ªå‡½æ•°è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼Œç­‰ç­‰ï¼‰
- å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆæˆ–ç§°ä½œä»»åŠ¡é˜Ÿåˆ—æˆ–å¾®ä»»åŠ¡æ ˆï¼‰ç”¨äºŽæ‰€æœ‰å…·æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„å¼‚æ­¥æ“ä½œï¼ˆprocess.nextTick, Promises, Object.observe, MutationObserverï¼‰
- å®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆæˆ–ç§°ä½œäº‹ä»¶é˜Ÿåˆ—ï¼Œä»»åŠ¡é˜Ÿåˆ—ï¼Œå®ä»»åŠ¡é˜Ÿåˆ—ï¼‰ç”¨äºŽæ‰€æœ‰å…·æœ‰è¾ƒä½Žä¼˜å…ˆçº§çš„å¼‚æ­¥æ“ä½œï¼ˆsetTimeout, setInterval, setImmediate, requestAnimationFrame, I/O, UI æ¸²æŸ“ï¼‰

ä»Žæ ˆçš„åº•éƒ¨åˆ°é¡¶éƒ¨æ‰§è¡Œæ‰€æœ‰çš„ä¸œè¥¿ï¼Œåªæœ‰å½“æ ˆä¸ºç©ºæ—¶ï¼Œæ‰æ£€æŸ¥ä¸Šé¢çš„é˜Ÿåˆ—ä¸­å‘ç”Ÿäº†ä»€ä¹ˆ

æ£€æŸ¥å¾®ä»»åŠ¡æ ˆå¹¶æ‰§è¡Œå…¶ä¸­çš„æ‰€æœ‰ä»»åŠ¡ï¼ˆå¦‚æžœéœ€è¦ï¼‰ï¼Œå€ŸåŠ©æ ˆï¼Œä¸€ä¸ªæŽ¥ä¸€ä¸ªåœ°æ‰§è¡Œå¾®ä»»åŠ¡ï¼Œç›´åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…ä¸éœ€è¦ä»»ä½•æ‰§è¡Œï¼Œç„¶åŽæ‰æ£€æŸ¥å®ä»»åŠ¡æ ˆ

æ£€æŸ¥å®ä»»åŠ¡æ ˆå¹¶æ‰§è¡Œå…¶ä¸­çš„æ‰€æœ‰ä»»åŠ¡ï¼ˆå¦‚æžœéœ€è¦ï¼‰ï¼Œå€ŸåŠ©æ ˆ

å¾®ä»»åŠ¡æ ˆä¸ä¼šè¢«è§¦åŠï¼Œé™¤éžæ ˆä¸ºç©ºã€‚å®ä»»åŠ¡æ ˆä¸ä¼šè¢«è§¦åŠï¼Œé™¤éžå¾®ä»»åŠ¡æ ˆä¸ºç©ºæˆ–è€…ä¸éœ€è¦ä»»ä½•æ‰§è¡Œã€‚

æ€»ä¹‹ï¼šå¾®ä»»åŠ¡é˜Ÿåˆ—å‡ ä¹Žå’Œå®ä»»åŠ¡é˜Ÿåˆ—ä¸€æ ·ï¼Œä½†æ˜¯è¿™äº›ä»»åŠ¡ï¼ˆprocess.nextTick, Promises, Object.observe, MutationObserverï¼‰æ¯”å®ä»»åŠ¡æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚

è¿™é‡Œä½ æœ‰ä¸€ä¸ª â€œç»ˆæžâ€ çš„ä»£ç æ¥ç†è§£æ‰€æœ‰çš„ä¸œè¥¿ã€‚

[console.log ('stack '); setTimeout ( () => console.log ("macro "), 0); setTimeout ( () => console.log ("macro "),](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|0|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"console.lo..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A42%2C"highlightText"%3A"console.log ('stack ')%3B setTimeout ( () %3D> console.log (\"macro \")%2C 0)%3B setTimeout ( () %3D> console.log (\"macro \")%2C 1)%3B const p %3D Promise.resolve ()%3B for (let i %3D 0%3B i < 3%3B i%2B%2B) p.then ( () %3D> { setTimeout ( () %3D> { console.log ('stack ') setTimeout ( () %3D> console.log (\"macro \")%2C 0)%3B p.then ( () %3D> console.log ('micro '))%3B }%2C 0)%3B console.log (\"stack \")%3B })%3B console.log (\"macro \")%3B %2F* Result%3A stack  macro  stack %2C stack %2C stack  macro  macro  stack  micro  stack  micro  stack  micro  macro %2C macro %2C macro  -------------------- but in node in versions < 11 (older versions) you will get something different stack  macro  stack %2C stack %2C stack  macro  macro  stack %2C stack %2C stack  micro %2C micro %2C micro  macro %2C macro %2C macro  more info%3A https%3A%2F%2Fblog.insiderattack.net%2Fnew-changes-to-timers-and-microtasks-from-node-v11-0-0-and-above-68d112743eb3 *%2F"%2C"snippets"%3A[]}})[1](https://edgeservices.bing.com/edgesvc/chat?udsframed=1&form=SHORUN&clientscopes=chat,noheader,udsedgeshop,channelstable,&shellsig=23a98999c2a001687090c030860007f40095fa85&setlang=zh-CN&lightschemeovr=1#sjevt|Discover.Chat.SydneyClickPageCitation|adpclick|0|9136103d-5c24-4303-ac66-e5d90d5bec93|{"sourceAttributions"%3A{"providerDisplayName"%3A"console.lo..."%2C"pageType"%3A"html"%2C"pageIndex"%3A1%2C"relatedPageUrl"%3A"https%3A%2F%2Fstackoverflow.com%2Fquestions%2F25915634%2Fdifference-between-microtask-and-macrotask-within-an-event-loop-context"%2C"lineIndex"%3A42%2C"highlightText"%3A"console.log ('stack ')%3B setTimeout ( () %3D> console.log (\"macro \")%2C 0)%3B setTimeout ( () %3D> console.log (\"macro \")%2C 1)%3B const p %3D Promise.resolve ()%3B for (let i %3D 0%3B i < 3%3B i%2B%2B) p.then ( () %3D> { setTimeout ( () %3D> { console.log ('stack ') setTimeout ( () %3D> console.log (\"macro \")%2C 0)%3B p.then ( () %3D> console.log ('micro '))%3B }%2C 0)%3B console.log (\"stack \")%3B })%3B console.log (\"macro \")%3B %2F* Result%3A stack  macro  stack %2C stack %2C stack  macro  macro  stack  micro  stack  micro  stack  micro  macro %2C macro %2C macro  -------------------- but in node in versions < 11 (older versions) you will get something different stack  macro  stack %2C stack %2C stack  macro  macro  stack %2C stack %2C stack  micro %2C micro %2C micro  macro %2C macro %2C macro  more info%3A https%3A%2F%2Fblog.insiderattack.net%2Fnew-changes-to-timers-and-microtasks-from-node-v11-0-0-and-above-68d112743eb3 *%2F"%2C"snippets"%3A[]}})